# bot/config/pricing.py
"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫, –ª–∏–º–∏—Ç–æ–≤ –∏ —Ü–µ–Ω.

–õ–ï–ì–ö–û –†–ï–î–ê–ö–¢–ò–†–£–ï–¢–°–Ø –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
–í –±—É–¥—É—â–µ–º ‚Äî –≤—ã–Ω–µ—Å—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É.

–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω –∏ –ª–∏–º–∏—Ç–æ–≤:
1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: supervisorctl restart telegram_bot
"""

from typing import Dict, Any, Optional

# =============================================================================
# –¢–ò–ü–´ –ê–ö–ö–ê–£–ù–¢–û–í / –ü–û–î–ü–ò–°–ö–ò
# =============================================================================

ACCOUNT_TYPES: Dict[str, Dict[str, Any]] = {
    "free": {
        "name": "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π",
        "emoji": "üë§",
        "price_rub": 0,
        "duration_days": None,  # –ë–µ—Å—Å—Ä–æ—á–Ω–æ
        "limits": {
            "max_active_ads": 100,           # –ú–∞–∫—Å. –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
            "ad_duration_days": 30,          # –°—Ä–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            "max_regions_per_ad": 1,         # –†–µ–≥–∏–æ–Ω–æ–≤ –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            "max_links_per_ad": 1,           # –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
            "max_photos_per_ad": 5,          # –§–æ—Ç–æ –≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏
            "video_allowed": False,          # –í–∏–¥–µ–æ –≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏
            "priority_moderation": False,    # –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è
            "statistics": "basic",           # basic / extended
            "support_priority": "normal",    # normal / high
        },
        "features": [],
        "description": "–ë–∞–∑–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π",
    },

    "pro": {
        "name": "PRO",
        "emoji": "‚≠ê",
        "price_rub": 199,
        "duration_days": 30,
        "limits": {
            "max_active_ads": 500,
            "ad_duration_days": 60,
            "max_regions_per_ad": 3,
            "max_links_per_ad": 2,
            "max_photos_per_ad": 10,
            "video_allowed": True,
            "priority_moderation": False,
            "statistics": "extended",
            "support_priority": "normal",
        },
        "features": ["badge_pro"],
        "description": "–î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤",
    },

    "business": {
        "name": "–ë–∏–∑–Ω–µ—Å",
        "emoji": "üíº",
        "price_rub": 499,
        "duration_days": 30,
        "limits": {
            "max_active_ads": 1000,
            "ad_duration_days": 90,
            "max_regions_per_ad": 10,
            "max_links_per_ad": 4,
            "max_photos_per_ad": 15,
            "video_allowed": True,
            "priority_moderation": True,
            "statistics": "extended",
            "support_priority": "high",
        },
        "features": ["badge_business", "priority_support", "analytics_pro"],
        "description": "–î–ª—è –±–∏–∑–Ω–µ—Å–∞ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤",
    },
}

# =============================================================================
# –ü–õ–ê–¢–ù–´–ï –£–°–õ–£–ì–ò
# =============================================================================

PAID_SERVICES: Dict[str, Dict[str, Any]] = {
    # -------------------------------------------------------------------------
    # –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    # -------------------------------------------------------------------------
    "ad_extend_7d": {
        "name": "–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 7 –¥–Ω–µ–π",
        "description": "–ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è",
        "category": "ad_duration",
        "price_rub": 19,
        "duration_hours": 7 * 24,
        "is_active": True,
    },
    "ad_extend_14d": {
        "name": "–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 14 –¥–Ω–µ–π",
        "description": "–ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è",
        "category": "ad_duration",
        "price_rub": 29,
        "duration_hours": 14 * 24,
        "is_active": True,
    },
    "ad_extend_30d": {
        "name": "–ü—Ä–æ–¥–ª–∏—Ç—å –Ω–∞ 30 –¥–Ω–µ–π",
        "description": "–ü—Ä–æ–¥–ª–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è",
        "category": "ad_duration",
        "price_rub": 49,
        "duration_hours": 30 * 24,
        "is_active": True,
    },

    # -------------------------------------------------------------------------
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    # -------------------------------------------------------------------------
    "ad_multiregion": {
        "name": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–≥–∏–æ–Ω",
        "description": "–ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º —Ä–µ–≥–∏–æ–Ω–µ",
        "category": "ad_feature",
        "price_rub": 19,
        "per_item": True,  # –¶–µ–Ω–∞ –∑–∞ –∫–∞–∂–¥—ã–π –¥–æ–ø. —Ä–µ–≥–∏–æ–Ω
        "is_active": True,
    },
    "ad_extra_link": {
        "name": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞",
        "description": "–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –æ–¥–Ω—É —Å—Å—ã–ª–∫—É –∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—é",
        "category": "ad_feature",
        "price_rub": 9,
        "per_item": True,
        "is_active": True,
    },
    "ad_video": {
        "name": "–í–∏–¥–µ–æ –≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏",
        "description": "–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ –∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—é",
        "category": "ad_feature",
        "price_rub": 29,
        "is_active": True,
    },

    # -------------------------------------------------------------------------
    # –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ
    # -------------------------------------------------------------------------
    "boost_up": {
        "name": "–ü–æ–¥–Ω—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ",
        "description": "–ü–æ–¥–Ω—è—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –ª–µ–Ω—Ç–µ –∫–∞–Ω–∞–ª–∞",
        "category": "promotion",
        "price_rub": 19,
        "cooldown_hours": 24,  # –ú–∏–Ω–∏–º—É–º 24—á –º–µ–∂–¥—É –ø–æ–¥–Ω—è—Ç–∏—è–º–∏
        "is_active": True,
    },
    "pin_channel_1h": {
        "name": "–ó–∞–∫—Ä–µ–ø –≤ –∫–∞–Ω–∞–ª–µ 1 —á–∞—Å",
        "description": "–ó–∞–∫—Ä–µ–ø–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª–µ –Ω–∞ 1 —á–∞—Å",
        "category": "promotion",
        "price_rub": 49,
        "duration_hours": 1,
        "is_active": True,
    },
    "pin_channel_3h": {
        "name": "–ó–∞–∫—Ä–µ–ø –≤ –∫–∞–Ω–∞–ª–µ 3 —á–∞—Å–∞",
        "description": "–ó–∞–∫—Ä–µ–ø–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª–µ –Ω–∞ 3 —á–∞—Å–∞",
        "category": "promotion",
        "price_rub": 99,
        "duration_hours": 3,
        "is_active": True,
    },
    "pin_channel_24h": {
        "name": "–ó–∞–∫—Ä–µ–ø –≤ –∫–∞–Ω–∞–ª–µ 24 —á–∞—Å–∞",
        "description": "–ó–∞–∫—Ä–µ–ø–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª–µ –Ω–∞ 24 —á–∞—Å–∞",
        "category": "promotion",
        "price_rub": 199,
        "duration_hours": 24,
        "is_active": True,
    },
    "story_publish": {
        "name": "–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Stories",
        "description": "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ Stories –∫–∞–Ω–∞–ª–∞",
        "category": "promotion",
        "price_rub": 79,
        "duration_hours": 24,
        "is_active": True,
    },
    "badge_urgent": {
        "name": "–ë–µ–π–¥–∂ ¬´–°—Ä–æ—á–Ω–æ¬ª",
        "description": "–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–∫—É —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—é",
        "category": "promotion",
        "price_rub": 29,
        "duration_hours": 7 * 24,
        "is_active": True,
    },
    "btn_call": {
        "name": "–ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–∑–≤–æ–Ω–∏—Ç—å¬ª",
        "description": "–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –±—ã—Å—Ç—Ä–æ–≥–æ –∑–≤–æ–Ω–∫–∞",
        "category": "promotion",
        "price_rub": 19,
        "is_active": True,
    },

    # -------------------------------------------------------------------------
    # –†–µ–∫–ª–∞–º–∞
    # -------------------------------------------------------------------------
    "banner_between_ads": {
        "name": "–ë–∞–Ω–Ω–µ—Ä –º–µ–∂–¥—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏",
        "description": "–†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä –º–µ–∂–¥—É –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏ –≤ –∫–∞–Ω–∞–ª–µ",
        "category": "advertising",
        "price_rub": 199,
        "duration_hours": 24,
        "is_active": True,
    },

    # -------------------------------------------------------------------------
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    # -------------------------------------------------------------------------
    "ads_pack_10": {
        "name": "+10 –æ–±—ä—è–≤–ª–µ–Ω–∏–π",
        "description": "–£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–∞ 10",
        "category": "account",
        "price_rub": 49,
        "ads_count": 10,
        "duration_hours": 30 * 24,
        "is_active": True,
    },
    "ads_pack_50": {
        "name": "+50 –æ–±—ä—è–≤–ª–µ–Ω–∏–π",
        "description": "–£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–∞ 50",
        "category": "account",
        "price_rub": 199,
        "ads_count": 50,
        "duration_hours": 30 * 24,
        "is_active": True,
    },
}

# =============================================================================
# –ö–ê–¢–ï–ì–û–†–ò–ò –£–°–õ–£–ì (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–µ–Ω—é)
# =============================================================================

SERVICE_CATEGORIES = {
    "ad_duration": {
        "name": "üìÖ –ü—Ä–æ–¥–ª–µ–Ω–∏–µ",
        "description": "–ü—Ä–æ–¥–ª–∏—Ç—å —Å—Ä–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏",
        "order": 1,
    },
    "ad_feature": {
        "name": "‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏",
        "description": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è",
        "order": 2,
    },
    "promotion": {
        "name": "üöÄ –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ",
        "description": "–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è",
        "order": 3,
    },
    "advertising": {
        "name": "üì¢ –†–µ–∫–ª–∞–º–∞",
        "description": "–†–µ–∫–ª–∞–º–Ω—ã–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è",
        "order": 4,
    },
    "account": {
        "name": "üë§ –ê–∫–∫–∞—É–Ω—Ç",
        "description": "–£—Å–ª—É–≥–∏ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞",
        "order": 5,
    },
}

# =============================================================================
# –ö–£–†–° STARS
# =============================================================================

STARS_CONFIG = {
    "usd_multiplier": 0.013,    # 1 Star = $0.013 (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫—É—Ä—Å Telegram)
    "discount": 0.9,            # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (0.9 = —Å–∫–∏–¥–∫–∞ 10%)
    "min_rate_rub": 1.0,        # –ú–∏–Ω–∏–º—É–º 1‚ÇΩ –∑–∞ –∑–≤–µ–∑–¥—É
    "update_hour_msk": 4,       # –ß–∞—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞ (–ú–°–ö)
    "fallback_usd_rub": 90.0,   # –ö—É—Ä—Å USD/RUB –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
}

# –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ –∫—É—Ä—Å–∞ Stars:
# star_rub = USD_RUB * usd_multiplier * discount
# star_rub = max(star_rub, min_rate_rub)
#
# –ü—Ä–∏–º–µ—Ä –ø—Ä–∏ USD/RUB = 90:
# star_rub = 90 * 0.013 * 0.9 = 1.053 ‚ÇΩ

# =============================================================================
# –ü–†–û–ú–û–ö–û–î–´
# =============================================================================

PROMO_TYPES = {
    "fixed_rub": {
        "name": "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞",
        "description": "–°–∫–∏–¥–∫–∞ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö",
    },
    "percent": {
        "name": "–ü—Ä–æ—Ü–µ–Ω—Ç —Å–∫–∏–¥–∫–∏",
        "description": "–°–∫–∏–¥–∫–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç —Å—É–º–º—ã",
    },
    "bonus_rub": {
        "name": "–ë–æ–Ω—É—Å –≤ —Ä—É–±–ª—è—Ö",
        "description": "–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å –≤ —Ä—É–±–ª—è—Ö",
    },
    "bonus_stars": {
        "name": "–ë–æ–Ω—É—Å –≤ Stars",
        "description": "–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å –≤ Stars",
    },
    "free_service": {
        "name": "–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —É—Å–ª—É–≥–∞",
        "description": "–û–¥–Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è —É—Å–ª—É–≥–∞",
    },
}

# =============================================================================
# –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
# =============================================================================

def get_service_price(service_code: str) -> Optional[float]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É —É—Å–ª—É–≥–∏ –≤ —Ä—É–±–ª—è—Ö"""
    service = PAID_SERVICES.get(service_code)
    if service and service.get("is_active"):
        return service.get("price_rub")
    return None


def get_account_limits(account_type: str) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è —Ç–∏–ø–∞ –∞–∫–∫–∞—É–Ω—Ç–∞"""
    account = ACCOUNT_TYPES.get(account_type, ACCOUNT_TYPES["free"])
    return account.get("limits", ACCOUNT_TYPES["free"]["limits"])


def get_active_services(category: Optional[str] = None) -> Dict[str, Dict]:
    """–ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —É—Å–ª—É–≥–∏, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"""
    services = {}
    for code, service in PAID_SERVICES.items():
        if not service.get("is_active"):
            continue
        if category and service.get("category") != category:
            continue
        services[code] = service
    return services


def get_subscription_price(account_type: str) -> Optional[float]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—É –ø–æ–¥–ø–∏—Å–∫–∏"""
    account = ACCOUNT_TYPES.get(account_type)
    if account:
        return account.get("price_rub")
    return None
